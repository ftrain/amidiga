[env:teensy41]
platform = teensy
board = teensy41
framework = arduino
; C++ standard
build_flags =
    -std=c++17
    -DUSB_MIDI
    -DUSB_MIDI_SERIAL
    -Wall
    -Wextra
    -fno-exceptions     ; Disable C++ exceptions for Teensy
    -DNO_EXCEPTIONS     ; Disable exception handling in our code
    -Os                 ; Optimize for size
    -DLUA_32BITS        ; Use 32-bit integers (saves ~30-40% memory)
    -DLUA_USE_C89       ; C89 compatibility for embedded systems
    -DLUA_USE_LONGJMP   ; Force Lua to use longjmp instead of C++ exceptions
    -ffunction-sections ; Enable garbage collection of unused sections
    -fdata-sections
    -Wl,--gc-sections   ; Link-time garbage collection

; Library dependencies
; NOTE: Using Teensy's built-in SD library instead of external SdFat
lib_deps =

; Automatic Lua 5.4.6 download and embedding
; Also skip size check (teensy_size incorrectly reports ITCM as RAM overflow)
extra_scripts =
    pre:scripts/embed_lua.py
    post:scripts/skip_size_check.py

; Filter to exclude desktop-specific files from build
src_filter =
    +<*>
    -<desktop/*>

; Build options
monitor_speed = 115200

; Optimization
build_type = release

; Upload options
upload_protocol = teensy-gui
upload_port = /dev/ttyACM0

; Debug options (optional)
debug_tool = jlink
debug_init_break = tbreak setup
