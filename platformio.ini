[env:teensy41]
platform = teensy
board = teensy41
framework = arduino
; C++ standard
build_flags =
    -std=c++17
    -DUSB_MIDI
    -DUSB_MIDI_SERIAL
    -Wall
    -Wextra
    -DLUA_32BITS        ; Use 32-bit integers (saves ~30-40% memory)
    -DLUA_USE_C89       ; C89 compatibility for embedded systems
    -DLUA_USE_POSIX     ; POSIX features

; Library dependencies
lib_deps =
    greiman/SdFat@^2.2.0

; Automatic Lua 5.4.6 download and embedding
extra_scripts = pre:scripts/embed_lua.py

; Source directories - use teensy-specific source
build_src_filter =
    +<*>
    +<../core/*>
    +<../hardware/*>
    +<../lua_bridge/*>
    -<../desktop/*>

; Filter to exclude desktop-specific files from build
src_filter =
    +<*>
    -<desktop/>

; Build options
monitor_speed = 115200

; Optimization
build_type = release

; Upload options
upload_protocol = teensy-gui
upload_port = /dev/ttyACM0

; Debug options (optional)
debug_tool = jlink
debug_init_break = tbreak setup
